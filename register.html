<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIAGNÓSTICO DE CONEXIÓN - LTFichaje</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <h2>Página de Diagnóstico</h2>
            <p>Sigue las instrucciones de las ventanas emergentes (alerts).</p>
            <p>Si la prueba tiene éxito, el botón de abajo registrará un usuario de prueba.</p>
            
            <form id="register-form" novalidate>
                <button type="submit" class="btn">Iniciar Prueba de Registro</button>
            </form>
        </div>
    </div>

    <!-- ****************************************************** -->
    <!--           PASO 1: CARGAR LA LIBRERÍA SUPABASE          -->
    <!-- ****************************************************** -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- ****************************************************** -->
    <!--            PASO 2: SCRIPT DE DIAGNÓSTICO             -->
    <!-- ****************************************************** -->
    <script>
        // Esta variable la usaremos para guardar la conexión
        let supa;

        // --- DIAGNÓSTICO DE CARGA ---
        alert("DIAGNÓSTICO: La página HTML y este script se han cargado.");

        if (window.supabase) {
            alert("✅ ¡ÉXITO! La librería de Supabase (desde la URL de internet) se ha cargado correctamente.");
        } else {
            alert("❌ ¡FALLO CRÍTICO! La librería de Supabase NO se ha cargado. Revisa la URL del script o posibles bloqueadores en tu navegador.");
        }

        // --- DIAGNÓSTICO DE CONEXIÓN ---
        try {
            // **IMPORTANTE: PON AQUÍ TUS CREDENCIALES REALES**
            const SUPABASE_URL = 'https://TU_URL_DE_SUPABASE.supabase.co';
            const SUPABASE_ANON_KEY = 'TU_CLAVE_ANON_PUBLICA';

            supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            
            if (supa) {
                alert("✅ ¡ÉXITO! La conexión con tu proyecto de Supabase se ha creado correctamente (la variable 'supa' existe).");
            } else {
                throw new Error("La función createClient no devolvió un cliente válido.");
            }

        } catch (error) {
            alert(`❌ ¡FALLO CRÍTICO! No se pudo crear la conexión con Supabase. Error: ${error.message}`);
        }

        // --- DIAGNÓSTICO DE REGISTRO ---
        const registerForm = document.getElementById('register-form');
        if (registerForm) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                alert("Iniciando prueba de registro...");
                
                if (!supa) {
                    alert("No se puede registrar porque la conexión 'supa' no existe.");
                    return;
                }

                try {
                    // Usamos un email y contraseña de prueba aleatorios
                    const email = `testuser_${Date.now()}@test.com`;
                    const password = 'password123';

                    const { data, error } = await supa.auth.signUp({ email, password });
                    if (error) throw error;
                    
                    alert(`✅ ¡REGISTRO EXITOSO! Se ha creado el usuario: ${data.user.email}. Revisa tu panel de Supabase en Authentication > Users.`);

                } catch (error) {
                    alert(`❌ FALLO EN EL REGISTRO: ${error.message}`);
                }
            });
        }

    </script>

</body>
</html>
